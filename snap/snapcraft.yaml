name: ktlint
version: git
summary: An anti-bikeshedding Kotlin linter with built-in formatter
description: |
   Kotlin linter in spirit of feross/standard (JavaScript) and gofmt (Go).

confinement: devmode

apps:
  ktlint:
    command: ktlint
    plugs: [home, network]
    environment:
      PATH: $PATH:$SNAP/usr/lib/jvm/java-8-openjdk/bin

parts:
  ktlint:
    source: .
    plugin: nil
    build-packages: [openjdk-8-jdk]
    stage-packages: [openjdk-8-jre]
    build: |
      bash -c "
      http_proxy_regex='^https?://(([^:]{1,128}):([^@]{1,256})@)?([^:/]{1,255})(:([0-9]{1,5}))?/?'
      if [[ \"$http_proxy\" =~ $http_proxy_regex ]]; then
        export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -Dhttp.proxyHost=${BASH_REMATCH[4]} -Dhttp.proxyPort=${BASH_REMATCH[6]:-80}\"
      fi
      if [[ \"$https_proxy\" =~ $http_proxy_regex ]]; then
        export JAVA_TOOL_OPTIONS=\"$JAVA_TOOL_OPTIONS -Dhttps.proxyHost=${BASH_REMATCH[4]} -Dhttps.proxyPort=${BASH_REMATCH[6]:-443}\"
      fi
      echo JAVA_TOOL_OPTIONS set to \"$JAVA_TOOL_OPTIONS\"
      ./mvnw -Pcapsule clean package -Dmaven.test.skip=true
      "
    install:
      mv ktlint/target/ktlint $SNAPCRAFT_PART_INSTALL
    organize:
      usr/lib/jvm/java-8-openjdk-*: usr/lib/jvm/java-8-openjdk
